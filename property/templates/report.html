<!DOCTYPE html>
<html lang="en">
  <head>
    {% load static %}
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Zono admin is super flexible, powerful, clean &amp; modern responsive bootstrap 5 admin template with unlimited possibilities.">
    <meta name="keywords" content="admin template, Zono admin template, dashboard template, flat admin template, responsive admin template, web app">
    <meta name="author" content="pixelstrap">
    <link rel="icon" href="{% static 'images/favicon.png' %}" type="image/x-icon">
    <link rel="shortcut icon" href="{% static 'images/favicon.png' %}" type="image/x-icon">
    <title>Zono - Premium Admin Template</title>
    <!-- Google font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@200;300;400;600;700;800;900&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i,900&amp;display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{% static 'css/font-awesome.css' %}">
    <!-- ico-font-->
    <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/icofont.css' %}">
    <!-- Themify icon-->
    <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/themify.css' %}">
    <!-- Flag icon-->
    <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/flag-icon.css' %}">
    <!-- Feather icon-->
    <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/feather-icon.css' %}">
    <!-- Plugins css start-->
    <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/slick.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/slick-theme.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/scrollbar.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/animate.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/datatables.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/owlcarousel.css' %}">
    <!-- Plugins css Ends-->
    <!-- Bootstrap css-->
    <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/bootstrap.css' %}">
    <!-- App css-->
    <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">
    <link id="color" rel="stylesheet" href="{% static 'css/color-1.css' %}" media="screen">
    <!-- Responsive css-->
    <link rel="stylesheet" type="text/css" href="{% static 'css/responsive.css' %}">
  </head>
  <style>
  </style>
  <body> 
     <!-- Loader -->
<div class="loader-wrapper">
  <div class="theme-loader">
    <div class="loader-p"></div>
  </div>
</div>

<!-- Page Wrapper -->
<div class="page-wrapper compact-wrapper d-flex flex-column" id="pageWrapper" style="min-height: 100vh;">
  {% include 'header.html' %}
  <div class="page-body-wrapper horizontal-menu">
    {% include 'sidenav.html' %}

    <!-- Main Content -->
    <div class="page-body d-flex flex-column flex-grow-1">
      <div class="container-fluid default-dashboard flex-grow-1">
        <div class="row">

          <!-- Upload CSV -->
          <!-- 上传文件模块 -->
          <div class="col-12 mb-3" style="margin-top: 30px;"> <!-- 调整顶部间距 -->
            <div class="card" style="z-index: 1; position: relative; padding: 20px; max-width: 100%; margin-left: 0;">
              <div class="card-body premium-card">
                <h1 class="f-w-700">Upload CSV</h1>
                <input type="file" id="csvFileInput" accept=".csv" class="form-control mt-3" style="max-width: 100%; margin-left: 0;">
              </div>
            </div>
          </div>

          <div id="contentPage" class="content-page">
            <!-- 数据块 1: Auction Information -->
            <div id="auctionInfoSection" class="content-section">
              <div class="card">
                <div class="card-header">Auction Information</div>
                <div class="card-body" id="auctionInfoList">
                  <p class="text-muted">No data loaded. Please upload a CSV file.</p>
                </div>
              </div>
            </div>
          
            <!-- 数据块 2: Government Official Data -->
            <div id="governmentDataSection" class="content-section">
              <div class="card">
                <div class="card-header">Government Official Data</div>
                <div class="card-body" id="governmentData">
                  <p class="text-muted">No data loaded.</p>
                </div>
              </div>
            </div>
          
            <!-- 数据块 3: Score Chart -->
            <div id="scoreChartSection" class="content-section">
              <div class="card">
                <div class="card-header">Score Chart</div>
                <div class="card-body">
                  <canvas id="scoreChart"></canvas>
                  <div id="chartLoader" style="display: none;">
                    <div class="spinner-border text-primary" role="status">
                      <span class="sr-only">Loading...</span>
                    </div>
                    <p class="text-muted">Loading chart...</p>
                  </div>
                </div>
              </div>
            </div>
          
            <!-- 数据块 4: Market Data -->
            <div id="marketDataSection" class="content-section">
              <div class="card">
                <div class="card-header">Market Data</div>
                <div class="card-body" id="marketData">
                  <p class="text-muted">No data loaded.</p>
                </div>
              </div>
            </div>
          </div>
          
          <!-- 统一分页控件 -->
          <div class="pagination-wrapper mt-3">
            <nav aria-label="Page navigation">
              <ul class="pagination justify-content-center" id="unifiedPagination"></ul>
            </nav>
          </div>

        </div> <!-- End Row -->
      </div> <!-- End Container -->
    </div> <!-- End Main Content -->
  </div> <!-- End Page Body Wrapper -->
  
  <!-- Footer -->
  {% include 'footer-light.html' %}
</div> <!-- End Page Wrapper -->


    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      (function () {
        const pagination = document.getElementById('unifiedPagination'); // 分页控件
        const auctionInfoSection = document.getElementById('auctionInfoList');
        const governmentDataSection = document.getElementById('governmentData');
        const marketDataSection = document.getElementById('marketData');
        const ctx = document.getElementById('scoreChart').getContext('2d');
        let scoreChart;
        let currentPage = 1; // 当前页码
        let totalPages = 1; // 总页数
        let data = []; // CSV 数据
    
        // 更新页面内容
        function updatePage(page) {
            if (page < 1 || page > totalPages) return;
            currentPage = page;
    
            // 获取当前页数据
            const row = data[page - 1];
            if (!row) return;
    
            // 更新各部分内容
            updateAuctionInfo(row);
            updateGovernmentData(row);
            updateMarketData(row);
            updateScoreChart(row);
    
            // 更新分页按钮状态
            initializePagination();
        }
    
        // 初始化分页控件
        function initializePagination() {
          pagination.innerHTML = '';
          totalPages = Math.ceil(data.length); // 总页数
          const maxVisiblePages = 5; // 可见页码数量范围
      
          // 上一页按钮
          const prevButton = document.createElement('li');
          prevButton.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
          prevButton.innerHTML = `<a class="page-link" href="#" aria-label="Previous">&laquo;</a>`;
          prevButton.onclick = () => updatePage(currentPage - 1);
          pagination.appendChild(prevButton);
      
          // 页码范围
          const startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
          const endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
      
          // 调整开始页码，确保范围正确
          const adjustedStartPage = Math.max(1, endPage - maxVisiblePages + 1);
      
          // 添加页码按钮
          for (let i = adjustedStartPage; i <= endPage; i++) {
              const pageButton = document.createElement('li');
              pageButton.className = `page-item ${i === currentPage ? 'active' : ''}`;
              pageButton.innerHTML = `<a class="page-link" href="#">${i}</a>`;
              pageButton.onclick = () => updatePage(i);
              pagination.appendChild(pageButton);
          }
      
          // 下一页按钮
          const nextButton = document.createElement('li');
          nextButton.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
          nextButton.innerHTML = `<a class="page-link" href="#" aria-label="Next">&raquo;</a>`;
          nextButton.onclick = () => updatePage(currentPage + 1);
          pagination.appendChild(nextButton);
      }
      
    
        // 更新 Auction Information
        function updateAuctionInfo(row) {
            auctionInfoSection.innerHTML = `
                <table class="table">
                    <tr>
                        <td><b>Property Street Address</b></td>
                        <td>${row['property_location'] || 'N/A'}</td>
                    </tr>
                    <tr>
                        <td><b>Parcel Number</b></td>
                        <td>${row['parcel_number'] || 'N/A'}</td>
                    </tr>
                    <tr>
                        <td><b>Batch Number</b></td>
                        <td>${row['batch_number'] || '-'}</td>
                    </tr>
                    <tr>
                        <td><b>Face Value</b></td>
                        <td>$${row['face_value'] || 'N/A'}</td>
                    </tr>
                    <tr>
                        <td><b>Auction Type</b></td>
                        <td>${row['auction_type'] || 'Lien'}</td>
                    </tr>
                    <tr>
                        <td><b>Auction Tax Year</b></td>
                        <td>${row['auction_tax_year'] || '2022'}</td>
                    </tr>
                </table>
            `;
        }
    
        // 更新 Government Data
        function updateGovernmentData(row) {
            governmentDataSection.innerHTML = `
                <table class="table">
                    <tr>
                        <td><b>Property Class</b></td>
                        <td>${row['property_class'] || '2 - Residential'}</td>
                        <td><b>Owner Name</b></td>
                        <td>${row['owner_name'] || 'N/A'}</td>
                    </tr>
                    <tr>
                        <td><b>Accessed Land Value</b></td>
                        <td>$${row['land_value'] || 'N/A'}</td>
                        <td><b>Accessed Improvement Value</b></td>
                        <td>$${row['improvement_value'] || 'N/A'}</td>
                    </tr>
                </table>
            `;
        }
    
        // 更新 Market Data
        function updateMarketData(row) {
            marketDataSection.innerHTML = `
                <table class="table">
                    <tr>
                        <td><b>Zillow Link</b></td>
                        <td><a href="${row['zillow_link'] || '#'}" target="_blank">View Listing</a></td>
                        <td><b>Zestimate</b></td>
                        <td>${row['zestimate'] || 'N/A'}</td>
                    </tr>
                    <tr>
                        <td><b>Year Built</b></td>
                        <td>${row['year_built'] || 'N/A'}</td>
                        <td><b>Lot</b></td>
                        <td>${row['lot'] || 'N/A'}</td>
                    </tr>
                    <tr>
                        <td><b>Nearby Schools</b></td>
                        <td colspan="3">${row['nearby_schools'] || 'N/A'}</td>
                    </tr>
                </table>
            `;
        }
    
        // 更新 Score Chart
        function updateScoreChart(row) {
            const walkScore = row['walk_score'] || 0;
            const transitScore = row['transit_score'] || 0;
            const bikeScore = row['bike_score'] || 0;
    
            if (scoreChart) {
                scoreChart.destroy();
            }
    
            scoreChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Walk Score', 'Transit Score', 'Bike Score'],
                    datasets: [{
                        label: 'Scores',
                        data: [walkScore, transitScore, bikeScore],
                        backgroundColor: [
                            'rgba(75, 192, 192, 0.6)',
                            'rgba(255, 99, 132, 0.6)',
                            'rgba(54, 162, 235, 0.6)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
    
        // CSV 文件上传处理
        document.getElementById('csvFileInput').addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (!file) return alert('Please select a CSV file.');
    
            Papa.parse(file, {
                header: true,
                skipEmptyLines: true,
                complete: function (results) {
                    data = results.data;
                    if (data.length > 0) {
                        totalPages = data.length;
                        updatePage(1);
                    } else {
                        alert('No data found in the CSV file.');
                    }
                }
            });
        });
    })();
    
    </script>
    
    <!-- latest jquery-->
    <script src="{% static 'js/jquery.min.js' %}"></script>
    <!-- Bootstrap js-->
    <script src="{% static 'js/bootstrap/bootstrap.bundle.min.js' %}"></script>
    <!-- feather icon js-->
    <script src="{% static 'js/icons/feather-icon/feather.min.js' %}"></script>
    <script src="{% static 'js/icons/feather-icon/feather-icon.js' %}"></script>
    <!-- scrollbar js-->
    <script src="{% static 'js/scrollbar/simplebar.js' %}"></script>
    <script src="{% static 'js/scrollbar/custom.js' %}"></script>
    <!-- Sidebar jquery-->
    <script src="{% static 'js/config.js' %}"></script>
    <!-- Plugins JS start-->
    <script src="{% static 'js/sidebar-menu.js' %}"></script>
    <script src="{% static 'js/sidebar-pin.js' %}"></script>
    <script src="{% static 'js/slick/slick.min.js' %}"></script>
    <script src="{% static 'js/slick/slick.js' %}"></script>
    <script src="{% static 'js/header-slick.js' %}"></script>
    <script src="{% static 'js/chart/morris-chart/raphael.js' %}"></script>
    <script src="{% static 'js/chart/morris-chart/morris.js' %}"></script>
    <script src="{% static 'js/chart/morris-chart/prettify.min.js' %}"></script>
    <script src="{% static 'js/chart/apex-chart/apex-chart.js' %}"></script>
    <script src="{% static 'js/chart/apex-chart/stock-prices.js' %}"></script>
    <script src="{% static 'js/chart/apex-chart/moment.min.js' %}"></script>
    <script src="{% static 'js/notify/bootstrap-notify.min.js' %}"></script>
    <script src="{% static 'js/dashboard/default.js' %}"></script>
    <script src="{% static 'js/notify/index.js' %}"></script>
    <script src="{% static 'js/datatable/datatables/jquery.dataTables.min.js' %}"></script>
    <script src="{% static 'js/datatable/datatables/datatable.custom.js' %}"></script>
    <script src="{% static 'js/datatable/datatables/datatable.custom1.js' %}"></script>
    <script src="{% static 'js/owlcarousel/owl.carousel.js' %}"></script>
    <script src="{% static 'js/owlcarousel/owl-custom.js' %}"></script>
    <script src="{% static 'js/typeahead/handlebars.js' %}"></script>
    <script src="{% static 'js/typeahead/typeahead.bundle.js' %}"></script>
    <script src="{% static 'js/typeahead/typeahead.custom.js' %}"></script>
    <script src="{% static 'js/typeahead-search/handlebars.js' %}"></script>
    <script src="{% static 'js/typeahead-search/typeahead-custom.js' %}"></script>
    <script src="{% static 'js/height-equal.js' %}"></script>
    <!-- Plugins JS Ends-->
    <!-- Theme js-->
    <script src="{% static 'js/script.js' %}"></script>
    <script src="{% static 'js/theme-customizer/customizer.js' %}"></script>
    <!-- Plugin used-->
  </body>
</html>