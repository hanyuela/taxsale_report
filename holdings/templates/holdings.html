<!DOCTYPE html>
<html lang="en">
    <head>
        {% load static %}
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Zono admin is super flexible, powerful, clean &amp; modern responsive bootstrap 5 admin template with unlimited possibilities.">
        <meta name="keywords" content="admin template, Zono admin template, dashboard template, flat admin template, responsive admin template, web app">
        <meta name="author" content="pixelstrap">
        <link rel="icon" href="{% static 'images/favicon.png' %}" type="image/x-icon">
        <link rel="shortcut icon" href="{% static 'images/favicon.png' %}" type="image/x-icon">
        <title>Zono - Premium Admin Template</title>
        <!-- Google font -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
        <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@200;300;400;600;700;800;900&amp;display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i,900&amp;display=swap" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="{% static 'css/font-awesome.css' %}">
        <!-- ico-font-->
        <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/icofont.css' %}">
        <!-- Themify icon-->
        <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/themify.css' %}">
        <!-- Flag icon-->
        <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/flag-icon.css' %}">
        <!-- Feather icon-->
        <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/feather-icon.css' %}">
        <!-- Plugins css start-->
        <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/slick.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/slick-theme.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/scrollbar.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/jsgrid.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/animate.css' %}">
        <!-- Plugins css Ends-->
        <!-- Bootstrap css-->
        <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/bootstrap.css' %}">
        <!-- App css-->
        <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">
        <link id="color" rel="stylesheet" href="{% static 'css/color-1.css' %}" media="screen">
        <!-- Responsive css-->
        <link rel="stylesheet" type="text/css" href="{% static 'css/responsive.css' %}">
    </head>  
    <style>
      .jsgrid-align-center {
          position: sticky; /* 固定列 */
          right: 0; /* 固定在右侧 */
          z-index: 2; /* 确保它显示在其他列的上面 */
          background-color: #fff; /* 背景颜色，防止被覆盖 */
          box-shadow: -2px 0 5px rgba(0, 0, 0, 0.2); /* 给固定列添加阴影效果 */
          width: 100px !important;
      }
      .archived-row {
        border-bottom: 1px dashed #ccc;
      }
      /* 隐藏 jsGrid 默认的删除按钮 */
      .jsgrid-button.jsgrid-delete-button {
          display: none !important;
      }
      .jsgrid .jsgrid-insert-mode-button{
        display: none !important;
      }
      .jsgrid {
        background: transparent;  /* 设置按钮背景透明 */
        border: none;              /* 去除按钮的默认边框 */
        cursor: pointer;           /* 使按钮看起来像点击区域 */
        padding: 5px 10px;         /* 可选：添加内边距 */
      }
      
      .jsgrid:focus {
        outline: none;  /* 去除焦点框 */
      }
      /* 设置图标颜色为灰色 */
      .jsgrid .fa-eye {
        color: gray;  /* 改为灰色 */
      }
      
      .jsgrid-header-row {
        padding-right: 20px; /* 根据需要增加右边距 */
      }
      /* 弹窗样式 */
      #columnOptions {
          display: none; /* 默认隐藏 */
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          z-index: 1000;
          background: #fff;
          padding: 20px;
          box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
          border-radius: 8px;
          width: 400px; /* 宽度 */
          max-height: 80vh;
          overflow-y: auto;
          text-align: center;
      }

      /* 分页导航按钮 */
      #tabNavigation {
          display: flex;
          justify-content: space-around;
          margin-bottom: 15px;
      }

      .tab-button {
          background-color: #f5f5f5; /* 按钮背景色 */
          border: 1px solid #ddd; /* 边框 */
          border-radius: 4px;
          padding: 10px 20px;
          cursor: pointer;
          transition: background-color 0.3s ease, color 0.3s ease;
          font-size: 14px;
      }

      .tab-button:hover {
          background-color: #e0e0e0; /* 悬停效果 */
      }

      .tab-button.active {
          background-color: #007bff; /* 激活背景色 */
          color: white; /* 激活文字颜色 */
          border-color: #007bff; /* 激活边框颜色 */
      }

      /* 分页内容样式 */
      #tabContent {
          border-top: 1px solid #ddd; /* 内容区顶部边框 */
          padding-top: 15px;
      }

      .tab {
          display: none; /* 默认隐藏 */
          padding: 10px;
          text-align: left; /* 内容左对齐 */
      }

      .tab.active {
          display: block; /* 激活状态下显示 */
      }

      /* 列表样式 */
      #columnSettingsList,
      #sortableColumnList {
          list-style-type: none; /* 移除默认列表样式 */
          margin: 0;
          padding: 0;
      }

      #columnSettingsList li,
      #sortableColumnList li {
          margin: 8px 0;
          padding: 10px;
          background: #f9f9f9; /* 列表项背景色 */
          border: 1px solid #ddd; /* 列表项边框 */
          border-radius: 4px; /* 圆角 */
          display: flex;
          align-items: center;
          cursor: pointer;
          transition: background-color 0.3s ease, box-shadow 0.3s ease;
      }

      #columnSettingsList li:hover,
      #sortableColumnList li:hover {
          background-color: #f1f1f1; /* 悬停背景色 */
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* 悬停阴影 */
      }

      /* 拖动项样式增强 */
      .sortable-item.dragging {
          background-color: #d1e7ff; /* 拖动时的背景色 */
          border-color: #007bff; /* 拖动时的边框颜色 */
          opacity: 0.8; /* 半透明效果 */
          transform: scale(1.05); /* 放大效果 */
          box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2); /* 添加阴影效果 */
          z-index: 1000; /* 确保拖动项位于最上层 */
          position: relative; /* 解决阴影层级问题 */
      }

      /* 列表项悬停效果 */
      #sortableColumnList li:hover {
          background-color: #f1f1f1; /* 悬停背景色 */
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* 添加悬停时的阴影 */
      }

      /* 拖动目标位置高亮 */
      .sortable-item.drop-target {
          border: 2px dashed #007bff; /* 目标位置的虚线边框 */
          background-color: #eaf4ff; /* 目标位置背景色 */
      }

      /* 滚动条样式（可选） */
      #columnOptions::-webkit-scrollbar {
          width: 8px;
      }

      #columnOptions::-webkit-scrollbar-thumb {
          background-color: #ccc;
          border-radius: 4px;
      }

      #columnOptions::-webkit-scrollbar-thumb:hover {
          background-color: #999;
      }
      
    </style>  
  <body> 
    <!-- Loader Section -->
<div class="loader-wrapper">
    <div class="theme-loader">
      <div class="loader-p"></div>
    </div>
  </div>
  
  <!-- Tap to Top Button -->
  <div class="tap-top">
    <i data-feather="chevrons-up"></i>
  </div>
  
  <!-- Page Wrapper -->
  <div class="page-wrapper compact-wrapper" id="pageWrapper">
    <!-- Header -->
    {% include 'header.html' %}
  
    <!-- Page Body Wrapper -->
    <div class="page-body-wrapper">
      <!-- Sidebar -->
      {% include 'sidenav.html' %}
  
      <!-- Main Content -->
      <div class="page-body">
        <div class="container-fluid">
          <!-- Page Title -->
          <div class="page-title">
            <div class="row">
             <!-- <div class="col-xl-4 col-sm-7 box-col-3">
                <h3>JS Grid Tables</h3>
              </div>
              -->
            </div>
          </div>
  
          <!-- Container Section -->
           
          <div class="container-fluid">
            <div class="row">
              <div class="col-sm-12">
                <div class="card">
                  <div class="card-header pb-0">
                    <h4 class="mb-3">Basic Scenario</h4>
                    <span>Grid with filtering, editing, inserting, deleting, sorting, and paging. Data provided by controller.</span>
                  </div>
                  <div class="column-control" style="position: absolute; right: 20px; top: 40px; ;">
                    <button id="columnSettings" class="btn btn-primary">
                        <i class="fa fa-cog"></i> Manage Columns
                    </button>
                </div>                
                  <div class="card-body">
                    <div class="basic_table" id="basicScenario"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="columnOptions" class="modal">
      <h4>Manage Columns</h4>
      
      <!-- 分页导航 -->
      <div id="tabNavigation">
        <button class="tab-button active" data-tab="visibility">Column Visibility</button>
        <button class="tab-button" data-tab="sorting">Column Sorting</button>
      </div>
    
      <!-- 分页内容 -->
      <div id="tabContent">
        <!-- 显示/隐藏列功能 -->
        <div id="visibility" class="tab active">
          <ul id="columnSettingsList">
            <li><label><input type="checkbox" class="column-toggle" data-column="Address" checked> Address</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="City" checked> City</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Zip" checked> Zip</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Auction Authority" checked> Auction Authority</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="State" checked> State</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Amount In Sale" checked> Amount In Sale</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Deposit Deadline" checked> Deposit Deadline</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Auction Start" checked> Auction Start</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Auction End" checked> Auction End</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="My Bid" checked> My Bid</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Label" checked> Status</label></li>
            <!-- 新字段 -->
            <li><label><input type="checkbox" class="column-toggle" data-column="Batch Number" checked> Batch Number</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Sort No" checked> Sort No</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Bankruptcy Flag" checked> Bankruptcy Flag</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Parcel Number" checked> Parcel Number</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Property Class" checked> Property Class</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Tax Overdue" checked> Tax Overdue</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Accessed Land Value" checked> Accessed Land Value</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Accessed Improvement Value" checked> Accessed Improvement Value</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Total Assessed Value" checked> Total Assessed Value</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Tax Amount Annual" checked> Tax Amount Annual</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Zillow Link" checked> Zillow Link</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Redfin Link" checked> Redfin Link</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Market Land Value" checked> Market Land Value</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Market Improvement Value" checked> Market Improvement Value</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Total Market Value" checked> Total Market Value</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Year Built" checked> Year Built</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Lot Size (sqft)" checked> Lot Size (sqft)</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Lot Size (acres)" checked> Lot Size (acres)</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Building Size (sqft)" checked> Building Size (sqft)</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Bedroom Number" checked> Bedroom Number</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Bathroom Number" checked> Bathroom Number</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Nearby Schools" checked> Nearby Schools</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Walk Score" checked> Walk Score</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Transit Score" checked> Transit Score</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Bike Score" checked> Bike Score</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Environmental Hazard Status" checked> Environmental Hazard Status</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Flood Status" checked> Flood Status</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Flood Risk" checked> Flood Risk</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Latest Sale Date" checked> Latest Sale Date</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Latest Sale Price" checked> Latest Sale Price</label></li>
          </ul>
        </div>
    
        <!-- 列排序功能 -->
        <div id="sorting" class="tab">
          <ul id="sortableColumnList">
            <li class="sortable-item" data-column="Address">Address</li>
            <li class="sortable-item" data-column="City">City</li>
            <li class="sortable-item" data-column="Zip">Zip</li>
            <li class="sortable-item" data-column="Auction Authority">Auction Authority</li>
            <li class="sortable-item" data-column="State">State</li>
            <li class="sortable-item" data-column="Amount In Sale">Amount In Sale</li>
            <li class="sortable-item" data-column="Deposit Deadline">Deposit Deadline</li>
            <li class="sortable-item" data-column="Auction Start">Auction Start</li>
            <li class="sortable-item" data-column="Auction End">Auction End</li>
            <li class="sortable-item" data-column="My Bid">My Bid</li>
            <li class="sortable-item" data-column="Label">Status</li>
            <li class="sortable-item" data-column="Batch Number">Batch Number</li>
            <li class="sortable-item" data-column="Sort No">Sort No</li>
            <li class="sortable-item" data-column="Bankruptcy Flag">Bankruptcy Flag</li>
            <li class="sortable-item" data-column="Parcel Number">Parcel Number</li>
            <li class="sortable-item" data-column="Property Class">Property Class</li>
            <li class="sortable-item" data-column="Tax Overdue">Tax Overdue</li>
            <li class="sortable-item" data-column="Accessed Land Value">Accessed Land Value</li>
            <li class="sortable-item" data-column="Accessed Improvement Value">Accessed Improvement Value</li>
            <li class="sortable-item" data-column="Total Assessed Value">Total Assessed Value</li>
            <li class="sortable-item" data-column="Tax Amount Annual">Tax Amount Annual</li>
            <li class="sortable-item" data-column="Zillow Link">Zillow Link</li>
            <li class="sortable-item" data-column="Redfin Link">Redfin Link</li>
            <li class="sortable-item" data-column="Market Land Value">Market Land Value</li>
            <li class="sortable-item" data-column="Market Improvement Value">Market Improvement Value</li>
            <li class="sortable-item" data-column="Total Market Value">Total Market Value</li>
            <li class="sortable-item" data-column="Year Built">Year Built</li>
            <li class="sortable-item" data-column="Lot Size (sqft)">Lot Size (sqft)</li>
            <li class="sortable-item" data-column="Lot Size (acres)">Lot Size (acres)</li>
            <li class="sortable-item" data-column="Building Size (sqft)">Building Size (sqft)</li>
            <li class="sortable-item" data-column="Bedroom Number">Bedroom Number</li>
            <li class="sortable-item" data-column="Bathroom Number">Bathroom Number</li>
            <li class="sortable-item" data-column="Nearby Schools">Nearby Schools</li>
            <li class="sortable-item" data-column="Walk Score">Walk Score</li>
            <li class="sortable-item" data-column="Transit Score">Transit Score</li>
            <li class="sortable-item" data-column="Bike Score">Bike Score</li>
            <li class="sortable-item" data-column="Environmental Hazard Status">Environmental Hazard Status</li>
            <li class="sortable-item" data-column="Flood Status">Flood Status</li>
            <li class="sortable-item" data-column="Flood Risk">Flood Risk</li>
            <li class="sortable-item" data-column="Latest Sale Date">Latest Sale Date</li>
            <li class="sortable-item" data-column="Latest Sale Price">Latest Sale Price</li>
          </ul>
        </div>
      </div>
    
      <!-- 按钮 -->
      <button id="saveColumnSettings" class="btn btn-success">Save</button>
      <button id="closeColumnSettings" class="btn btn-secondary">Cancel</button>
    </div>
    
    <!-- Footer -->
    
      {% include 'footer-light.html' %}
    
    </div>
   
    <script>
      document.querySelectorAll(".tab-button").forEach(button => {
        button.addEventListener("click", function () {
          const targetTab = this.dataset.tab;
    
          // 切换按钮状态
          document.querySelectorAll(".tab-button").forEach(btn => btn.classList.remove("active"));
          this.classList.add("active");
    
          // 切换内容显示
          document.querySelectorAll(".tab").forEach(tab => tab.classList.remove("active"));
          document.getElementById(targetTab).classList.add("active");
        });
      });
    
      // 点击配置列按钮，显示弹窗
      document.getElementById("columnSettings").addEventListener("click", function () {
        const modal = document.getElementById("columnOptions");
        modal.style.display = "block"; // 显示弹窗
      });
    
      // 点击取消按钮，隐藏弹窗
      document.getElementById("closeColumnSettings").addEventListener("click", function () {
        const modal = document.getElementById("columnOptions");
        modal.style.display = "none"; // 隐藏弹窗
      });
    
      // 点击保存按钮，保存设置并更新表格
      document.getElementById("saveColumnSettings").addEventListener("click", function () {
        const grid = $("#basicScenario").data("JSGrid");
    
        // 保存列显示状态到 localStorage
        const columnSettings = {};
        document.querySelectorAll(".column-toggle").forEach(function (checkbox) {
          const columnName = checkbox.dataset.column;
          const isVisible = checkbox.checked;
          columnSettings[columnName] = isVisible;
        });
        localStorage.setItem("columnSettings", JSON.stringify(columnSettings)); // 保存到 localStorage
    
        // 保存当前的列排序顺序到 localStorage
        const columnOrder = [...document.querySelectorAll("#sortableColumnList .sortable-item")]
          .filter(item => item.style.display !== "none") // 仅保存可见列
          .map(item => item.dataset.column);
        localStorage.setItem("columnOrder", JSON.stringify(columnOrder));
    
        // 按新顺序更新表格字段
        const orderedFields = [];
        columnOrder.forEach(columnName => {
          const field = grid.fields.find(field => field.name === columnName);
          if (field) {
            field.visible = columnSettings[columnName]; // 更新显示状态
            orderedFields.push(field); // 按顺序添加字段
          }
        });
    
        // 更新表格字段并刷新
        grid.fields = orderedFields;
        $("#basicScenario").jsGrid("option", "fields", grid.fields);
        $("#basicScenario").jsGrid("refresh");
    
        // 隐藏弹窗
        const modal = document.getElementById("columnOptions");
        modal.style.display = "none";
      });
    
      // 页面加载时，读取保存的列设置
      window.addEventListener("load", function () {
        const savedColumnSettings = localStorage.getItem("columnSettings");
        const savedColumnOrder = JSON.parse(localStorage.getItem("columnOrder") || "[]");
    
        const grid = $("#basicScenario").data("JSGrid");
    
        if (savedColumnSettings) {
          const columnSettings = JSON.parse(savedColumnSettings);
    
          // 遍历复选框并设置其状态
          document.querySelectorAll(".column-toggle").forEach(function (checkbox) {
            const columnName = checkbox.dataset.column;
            const isVisible = columnSettings[columnName];
            checkbox.checked = isVisible; // 根据保存的设置更新复选框状态
          });
    
          // 如果有保存的排序，则按照顺序重新排列
          const sortableList = document.getElementById("sortableColumnList");
          if (savedColumnOrder.length > 0) {
            savedColumnOrder.forEach(columnName => {
              const item = sortableList.querySelector(`[data-column="${columnName}"]`);
              if (item) {
                sortableList.appendChild(item); // 按顺序追加
              }
            });
          }
    
          // 初始化表格列的显示状态和排序
          const orderedFields = [];
          savedColumnOrder.forEach(columnName => {
            const field = grid.fields.find(field => field.name === columnName);
            if (field) {
              field.visible = columnSettings[columnName];
              orderedFields.push(field);
            }
          });
    
          grid.fields = orderedFields;
          $("#basicScenario").jsGrid("option", "fields", grid.fields);
          $("#basicScenario").jsGrid("refresh");
        } else {
          // 如果没有保存的列设置，确保一开始默认所有列都可见
          document.querySelectorAll(".column-toggle").forEach(function (checkbox) {
            checkbox.checked = true; // 默认选中所有复选框
          });
    
          // 获取当前的 grid 对象并确保所有列可见
          grid.fields.forEach(function (field) {
            field.visible = true; // 设置每列的可见性为 true
          });
    
          // 更新表格并刷新
          $("#basicScenario").jsGrid("option", "fields", grid.fields);
          $("#basicScenario").jsGrid("refresh");
        }
    
        // 同步排序项状态
        syncSortingList();
      });
    
      // 同步排序项状态（隐藏已隐藏的列）
      function syncSortingList() {
        const columnSettings = JSON.parse(localStorage.getItem("columnSettings") || "{}");
    
        document.querySelectorAll("#sortableColumnList .sortable-item").forEach(function (item) {
          const columnName = item.dataset.column;
          const isVisible = columnSettings[columnName];
          item.style.display = isVisible ? "block" : "none"; // 根据列显示状态同步排序项
        });
      }
    
      // 初始化拖动排序功能
      function enableDragAndDrop() {
        const sortableList = document.getElementById("sortableColumnList");
        let draggedItem = null;
        let isDragging = false;

        // 阻止文字选择的事件
        sortableList.addEventListener("mousedown", (e) => {
          if (e.target.classList.contains("sortable-item")) {
            e.preventDefault(); // 禁用默认行为（如文字选中）
          }
        });

        // 鼠标按下时准备拖动
        sortableList.addEventListener("mousedown", function (e) {
          if (e.target.classList.contains("sortable-item")) {
            draggedItem = e.target;
            draggedItem.classList.add("dragging");
            isDragging = true; // 标记正在拖动
          }
        });

        // 鼠标抬起时结束拖动
        sortableList.addEventListener("mouseup", function () {
          if (draggedItem) {
            draggedItem.classList.remove("dragging");
            draggedItem = null;
            isDragging = false; // 清除拖动状态
          }
        });

        // 鼠标移动时处理拖动
        sortableList.addEventListener("mousemove", function (e) {
          if (isDragging) {
            e.preventDefault(); // 阻止默认行为
            const afterElement = getDragAfterElement(sortableList, e.clientY);
            if (draggedItem) {
              if (afterElement == null) {
                sortableList.appendChild(draggedItem);
              } else {
                sortableList.insertBefore(draggedItem, afterElement);
              }
            }
          }
        });

        // 获取拖动后的位置
        function getDragAfterElement(container, y) {
          const draggableElements = [...container.querySelectorAll(".sortable-item:not(.dragging)")];

          return draggableElements.reduce(
            (closest, child) => {
              const box = child.getBoundingClientRect();
              const offset = y - box.top - box.height / 2;
              if (offset < 0 && offset > closest.offset) {
                return { offset: offset, element: child };
              } else {
                return closest;
              }
            },
            { offset: Number.NEGATIVE_INFINITY, element: null }
          ).element;
        }
      }

      // 页面加载时初始化拖动功能
      window.addEventListener("load", function () {
        enableDragAndDrop();
      });

    </script>
    
    
  

    <script>
      window.addEventListener('resize', () => {
        const grid = $('#grid').data('JSGrid');
        if (grid) {
          grid.refresh(); // 重新渲染表格
        }
      });
      
    </script> 
    <!-- latest jquery-->
    <script src="{% static 'js/jquery.min.js' %}"></script>
    <!-- Bootstrap js-->
    <script src="{% static 'js/bootstrap/bootstrap.bundle.min.js' %}"></script>
    <!-- feather icon js-->
    <script src="{% static 'js/icons/feather-icon/feather.min.js' %}"></script>
    <script src="{% static 'js/icons/feather-icon/feather-icon.js' %}"></script>
    <!-- scrollbar js-->
    <script src="{% static 'js/scrollbar/simplebar.js' %}"></script>
    <script src="{% static 'js/scrollbar/custom.js' %}"></script>
    <!-- Sidebar jquery-->
    <script src="{% static 'js/config.js' %}"></script>
    <!-- Plugins JS start-->
    <script src="{% static 'js/sidebar-menu.js' %}"></script>
    <script src="{% static 'js/sidebar-pin.js' %}"></script>
    <script src="{% static 'js/slick/slick.min.js' %}"></script>
    <script src="{% static 'js/slick/slick.js' %}"></script>
    <script src="{% static 'js/header-slick.js' %}"></script>
    <script src="{% static 'js/jsgrid/jsgrid.min.js' %}"></script>
    <script src="{% static 'js/jsgrid/griddata.js' %}"></script>
    <script src="{% static 'js/jsgrid/jsgrid.js' %}"></script>
    <!-- Plugins JS Ends-->
    <!-- Theme js-->
    <script src="{% static 'js/script.js' %}"></script>
    <script src="{% static 'js/theme-customizer/customizer.js' %}"></script>
    <!-- Plugin used-->
  </body>
</html>