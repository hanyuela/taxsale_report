<!DOCTYPE html>
<html lang="en">
  <head>
    {% load static %}
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Zono admin is super flexible, powerful, clean &amp; modern responsive bootstrap 5 admin template with unlimited possibilities.">
    <meta name="keywords" content="admin template, Zono admin template, dashboard template, flat admin template, responsive admin template, web app">
    <meta name="author" content="pixelstrap">
    <link rel="icon" href="{% static 'images/favicon.png' %}" type="image/x-icon">
    <link rel="shortcut icon" href="{% static 'images/favicon.png' %}" type="image/x-icon">
    <title>Zono - Premium Admin Template</title>
    <!-- Google fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@200;300;400;600;700;800;900&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i,900&amp;display=swap" rel="stylesheet">
    <!-- Select2 CSS -->
    <!-- Custom CSS files -->
    <link rel="stylesheet" type="text/css" href="{% static 'css/font-awesome.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/icofont.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/themify.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/flag-icon.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/feather-icon.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/animate.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/bootstrap.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">
    <link id="color" rel="stylesheet" href="{% static 'css/color-1.css' %}" media="screen">
    <link rel="stylesheet" type="text/css" href="{% static 'css/responsive.css' %}">
  </head>
  <style>
        /* 移除上下的空白 */
        body, html {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        .container-fluid {
            height: 100%;
            padding: 0;
        }
        .card {
            height: 100%;
            margin: 0;
            padding: 20px 80px 20px; /* 减少底部 padding */
            box-sizing: border-box;
        }
    </style>
</style>
  <body> 
    <!-- loader starts-->
    <div class="loader-wrapper">
      <div class="theme-loader">    
        <div class="loader-p"></div>
      </div>
    </div>
    <!-- loader ends-->
    <!-- tap on top starts-->
    <div class="tap-top"><i data-feather="chevrons-up"></i></div>
    <!-- tap on tap ends-->
    <!-- page-wrapper Start-->
    <div class="page-wrapper compact-wrapper" id="pageWrapper">
      <!-- Page Header Start-->
      {% include 'header.html' %}
      <!-- Page Header Ends                              -->
      <!-- Page Body Start-->
      <div class="page-body-wrapper">
        <!-- Page Sidebar Start-->
        {% include 'sidenav.html' %}
        <!-- Page Sidebar Ends-->
        <div class="page-body">
          <div class="container-fluid">
            <div class="page-title">
              <div class="row">
                <div class="col-xl-4 col-sm-7 box-col-3">
                  <h3>Validation Form</h3>
                </div>
                <div class="col-5 d-none d-xl-block">
                  <!-- Page Sub Header Start-->
                  
                  <!-- Page Sub Header end
                  -->
                </div>
              </div>
            </div>
          </div>
          <div class="container-fluid">
            <div class="row h-100">
                <div class="col-12 h-100">
                    <div class="card h-100">
                      <div class="card-header" style="margin-left: -20px;">
                        <h4>Investment Preferences</h4>
                      </div>
                        <form method="post">
                          {% csrf_token %}
                      
                          <!-- 
                          <div class="mb-3">
                              <label class="form-label">My main purpose for investing in tax sales?</label>
                              <div>
                                  <input type="radio" id="earn_interest" name="goal" value="Earn Interest" 
                                      {% if user_criteria.goal == 'Earn Interest' %}checked{% endif %}>
                                  <label for="earn_interest">Earn Interest</label>
                              </div>
                              <div>
                                  <input type="radio" id="foreclosure" name="goal" value="Foreclose on properties" 
                                      {% if user_criteria.goal == 'Foreclose on properties' %}checked{% endif %}>
                                  <label for="foreclosure">Foreclose on properties</label>
                              </div>
                          </div>
                            -->

                          <!-- Property Type (多选) -->
                            <div>
                                <p><strong>Property Type:</strong></p>
                                <div style="display: flex; flex-wrap: wrap; gap: 5px;">
                                    <div style="width: 48%;">
                                        <input type="checkbox" id="single_family_residential" name="property_type" value="single_family_residential" 
                                            {% if 'single_family_residential' in user_criteria.property_type %}checked{% endif %}>
                                        <label for="single_family_residential">Single-Family Residential</label>
                                    </div>
                                    <div style="width: 48%;">
                                        <input type="checkbox" id="multi_family_residential" name="property_type" value="multi_family_residential" 
                                            {% if 'multi_family_residential' in user_criteria.property_type %}checked{% endif %}>
                                        <label for="multi_family_residential">Multi-Family Residential</label>
                                    </div>
                                    <div style="width: 48%;">
                                        <input type="checkbox" id="other_residential" name="property_type" value="other_residential" 
                                            {% if 'other_residential' in user_criteria.property_type %}checked{% endif %}>
                                        <label for="other_residential">Other Residential</label>
                                    </div>
                                    <div style="width: 48%;">
                                        <input type="checkbox" id="commercial" name="property_type" value="commercial" 
                                            {% if 'commercial' in user_criteria.property_type %}checked{% endif %}>
                                        <label for="commercial">Commercial</label>
                                    </div>
                                    <div style="width: 48%;">
                                        <input type="checkbox" id="vacant_land" name="property_type" value="vacant_land" 
                                            {% if 'vacant_land' in user_criteria.property_type %}checked{% endif %}>
                                        <label for="vacant_land">Vacant Land</label>
                                    </div>
                                    <div style="width: 48%;">
                                        <input type="checkbox" id="industrial" name="property_type" value="industrial" 
                                            {% if 'industrial' in user_criteria.property_type %}checked{% endif %}>
                                        <label for="industrial">Industrial</label>
                                    </div>
                                    <div style="width: 48%;">
                                        <input type="checkbox" id="agricultural" name="property_type" value="agricultural" 
                                            {% if 'agricultural' in user_criteria.property_type %}checked{% endif %}>
                                        <label for="agricultural">Agricultural</label>
                                    </div>
                                    <div style="width: 48%;">
                                        <input type="checkbox" id="miscellaneous" name="property_type" value="miscellaneous" 
                                            {% if 'miscellaneous' in user_criteria.property_type %}checked{% endif %}>
                                        <label for="miscellaneous">Miscellaneous</label>
                                    </div>
                                </div>
                            </div>

                                                    
                            <!-- 第一组：Auction Type (Tax Lien 和 Tax Deed) -->
                            <div>
                                <p><strong>Auction Type:</strong></p>
                                <div style="display: flex; flex-wrap: wrap; gap: 5px;">
                                    <div style="width: 48%;">
                                        <input type="checkbox" id="tax_lien" name="auction_type" value="tax lien" 
                                            {% if 'tax lien' in user_criteria.auction_type %}checked{% endif %}>
                                        <label for="tax_lien">Tax Lien</label>
                                    </div>
                                    <div style="width: 48%;">
                                        <input type="checkbox" id="tax_deed" name="auction_type" value="tax deed" 
                                            {% if 'tax deed' in user_criteria.auction_type %}checked{% endif %}>
                                        <label for="tax_deed">Tax Deed</label>
                                    </div>
                                </div>
                            </div>

                            <!-- 第二组：Auction Mode (Online 和 In-person) -->
                            <div>
                                <p><strong>Auction Mode:</strong></p>
                                <div style="display: flex; flex-wrap: wrap; gap: 5px;">
                                    <div style="width: 48%;">
                                        <input type="checkbox" id="online" name="is_online" value="online" 
                                            {% if 'online' in user_criteria.is_online %}checked{% endif %}>
                                        <label for="online">Online</label>
                                    </div>
                                    <div style="width: 48%;">
                                        <input type="checkbox" id="in_person" name="is_online" value="in-person" 
                                            {% if 'in-person' in user_criteria.is_online %}checked{% endif %}>
                                        <label for="in_person">In-person</label>
                                    </div>
                                </div>
                            </div>

                                
                      
                          <!-- 市场价值范围 -->
                          <div class="mb-3">
                            <label class="form-label">
                                <strong>What is the market value of the property you are looking to invest in?</strong>
                            </label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span>Market value range: </span>
                                <input type="number" id="market_value_min" name="market_value_min" class="form-control" placeholder="Min $" 
                                    value="{{ user_criteria.market_value_min|floatformat:0 }}" style="width: 150px;" 
                                    min="0" max="1000000000" step="1" 
                                    oninput="validateMinMaxRange()">
                                <span>~</span>
                                <input type="number" id="market_value_max" name="market_value_max" class="form-control" placeholder="Max $" 
                                    value="{{ user_criteria.market_value_max|floatformat:0 }}" style="width: 150px;" 
                                    min="0" max="1000000000" step="1" 
                                    oninput="validateMinMaxRange()">
                            </div>
                          </div>

                          <!-- 面值范围 -->
                          <div class="mb-3">
                            <label class="form-label">
                                <strong>How much tax are you willing to pay at the auction for each property?</strong>
                            </label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span>Face value range: </span>
                                <input type="number" id="face_value_min" name="face_value_min" class="form-control" placeholder="Min $" 
                                    value="{{ user_criteria.face_value_min|floatformat:0 }}" style="width: 150px;" 
                                    min="0" max="1000000000" step="1" 
                                    oninput="validateMinMaxRange()">
                                <span>~</span>
                                <input type="number" id="face_value_max" name="face_value_max" class="form-control" placeholder="Max $" 
                                    value="{{ user_criteria.face_value_max|floatformat:0 }}" style="width: 150px;" 
                                    min="0" max="1000000000" step="1" 
                                    oninput="validateMinMaxRange()">
                            </div>
                          </div>
                      
                          <!-- 已选择的州 -->
                          <div class="mb-3">
                              <label class="form-label">Selected States</label>
                              <div id="selected-states">
                                  {% for state in user_criteria.states.all %}
                                  <span class="badge bg-primary text-white state-badge" data-id="{{ state.id }}">
                                      {{ state.state }}
                                      <button type="button" class="btn-close btn-close-white remove-state" aria-label="Close" data-id="{{ state.id }}"></button>
                                  </span>
                                  {% endfor %}
                              </div>
                          </div>
                      
                          <!-- 选择州 -->
                          <div class="mb-3">
                            <label class="form-label" for="states" style="font-weight: bold;">Select States</label>
                            <select id="states" name="states" class="form-control" multiple style="height: 200px;">
                                {% for state in all_states %}
                                <option value="{{ state.id }}" 
                                        {% if state in user_criteria.states.all %}selected{% endif %}>
                                    {{ state.state }}
                                </option>
                                {% endfor %}
                            </select>
                          </div>
                        
                          <button type="submit" class="btn btn-primary">Save Preferences</button>
                      </form>
                      
                    </div>
                </div>
            </div>
        </div>
      </div>
        
        <!-- footer start-->
        {% include 'footer-light.html' %}
        <script>
            function validateMinMaxRange() {
                // 获取市场价值的最小值和最大值输入框
                let minInputs = document.querySelectorAll('[id$="_min"]');
                let maxInputs = document.querySelectorAll('[id$="_max"]');
        
                minInputs.forEach((minInput, index) => {
                    let maxInput = maxInputs[index]; // 对应的最大值输入框
        
                    // 获取输入框的值
                    let minValue = minInput.value ? parseInt(minInput.value) : null;
                    let maxValue = maxInput.value ? parseInt(maxInput.value) : null;
        
                    // 如果最小值存在并且大于最大限制
                    if (minValue !== null && minValue > 1000000000) {
                        minInput.setCustomValidity('Minimum value must be less than or equal to 1,000,000,000!');
                        maxInput.setCustomValidity(''); // 清除对应最大值的错误提示
                    } 
                    // 如果最大值存在并且大于最大限制
                    else if (maxValue !== null && maxValue > 1000000000) {
                        maxInput.setCustomValidity('Maximum value must be less than or equal to 1,000,000,000!');
                        minInput.setCustomValidity(''); // 清除对应最小值的错误提示
                    } 
                    // 如果最小值大于最大值，触发错误提示
                    else if (minValue !== null && maxValue !== null && minValue > maxValue) {
                        minInput.setCustomValidity('Minimum value must not exceed the maximum value!');
                        maxInput.setCustomValidity('Minimum value must not exceed the maximum value!');
                    } 
                    // 如果输入不是整数
                    else if (minInput.value !== "" && !Number.isInteger(Number(minInput.value))) {
                        minInput.setCustomValidity('Please enter a valid integer!');
                    } 
                    else if (maxInput.value !== "" && !Number.isInteger(Number(maxInput.value))) {
                        maxInput.setCustomValidity('Please enter a valid integer!');
                    }
                    // 输入合法，清除所有提示
                    else {
                        minInput.setCustomValidity('');
                        maxInput.setCustomValidity('');
                    }
                });
            }
        </script>   
        <script>
          document.addEventListener('DOMContentLoaded', function () {
            const selectedStatesDiv = document.getElementById('selected-states');
            const statesSelect = document.getElementById('states');
        
            // 初始化：页面加载时，将已选中的选项添加到徽章区域
            Array.from(statesSelect.options).forEach(option => {
                if (option.selected) {
                    addBadge(option.value, option.text);
                }
            });
        
            // 添加徽章的函数
            function addBadge(stateId, stateName) {
                if (!selectedStatesDiv.querySelector(`.state-badge[data-id="${stateId}"]`)) {
                    const badge = document.createElement('span');
                    badge.className = 'badge bg-primary text-white state-badge';
                    badge.dataset.id = stateId;
                    badge.innerHTML = `${stateName} <button type="button" class="btn-close btn-close-white remove-state" aria-label="Close" data-id="${stateId}"></button>`;
                    selectedStatesDiv.appendChild(badge);
                }
            }
        
            // 删除徽章的函数
            function removeBadge(stateId) {
                const badge = selectedStatesDiv.querySelector(`.state-badge[data-id="${stateId}"]`);
                if (badge) {
                    badge.remove();
                }
            }
        
            // 实时处理多选框：支持单击切换选中状态
            statesSelect.addEventListener('mousedown', function (event) {
                event.preventDefault(); // 禁止默认拖动选择行为
        
                const option = event.target;
                if (option.tagName === 'OPTION') {
                    // 切换选中状态
                    option.selected = !option.selected;
        
                    // 手动触发 change 事件以更新徽章显示
                    statesSelect.dispatchEvent(new Event('change'));
                }
            });
        
            // 处理多选框 change 事件：同步徽章显示
            statesSelect.addEventListener('change', function () {
                // 获取所有选中的选项
                const selectedIds = Array.from(statesSelect.selectedOptions).map(option => option.value);
        
                // 添加选中的州为徽章
                Array.from(statesSelect.options).forEach(option => {
                    if (option.selected) {
                        addBadge(option.value, option.text);
                    } else {
                        removeBadge(option.value); // 移除未选中的州的徽章
                    }
                });
            });
        
            // 点击删除按钮时，同步移除徽章和下拉框选中状态
            selectedStatesDiv.addEventListener('click', function (event) {
                if (event.target.classList.contains('remove-state')) {
                    const stateId = event.target.getAttribute('data-id');
        
                    // 从显示区域移除徽章
                    removeBadge(stateId);
        
                    // 在下拉框中取消选中
                    const optionToDeselect = statesSelect.querySelector(`option[value="${stateId}"]`);
                    if (optionToDeselect) {
                        optionToDeselect.selected = false;
        
                        // 手动触发多选框的 change 事件
                        statesSelect.dispatchEvent(new Event('change'));
                    }
                }
            });
        });
        
      </script>     
    <!-- latest jquery-->
    <script src="{% static 'js/jquery.min.js' %}"></script>
    <!-- Bootstrap js-->
    <script src="{% static 'js/bootstrap/bootstrap.bundle.min.js' %}"></script>
    <!-- feather icon js-->
    <script src="{% static 'js/icons/feather-icon/feather.min.js' %}"></script>
    <script src="{% static 'js/icons/feather-icon/feather-icon.js' %}"></script>
    <!-- scrollbar js-->
    <script src="{% static 'js/scrollbar/simplebar.js' %}"></script>
    <script src="{% static 'js/scrollbar/custom.js' %}"></script>
    <!-- Sidebar jquery-->
    <script src="{% static 'js/config.js' %}"></script>
    <!-- Plugins JS start-->
    <script src="{% static 'js/sidebar-menu.js' %}"></script>
    <script src="{% static 'js/sidebar-pin.js' %}"></script>
    <script src="{% static 'js/slick/slick.min.js' %}"></script>
    <script src="{% static 'js/slick/slick.js' %}"></script>
    <script src="{% static 'js/header-slick.js' %}"></script>
    <script src="{% static 'js/form-validation-custom.js' %}"></script>
    <script src="{% static 'js/height-equal.js' %}"></script>
    <!-- Plugins JS Ends-->
    <!-- Theme js-->
    <script src="{% static 'js/script.js' %}"></script>
    <script src="{% static 'js/theme-customizer/customizer.js' %}"></script>
    <!-- Plugin used-->
     
  </body>
</html>