<!DOCTYPE html>
<html lang="en">
    <head>
        {% load static %}
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Zono admin is super flexible, powerful, clean &amp; modern responsive bootstrap 5 admin template with unlimited possibilities.">
        <meta name="keywords" content="admin template, Zono admin template, dashboard template, flat admin template, responsive admin template, web app">
        <meta name="author" content="pixelstrap">
        <link rel="icon" href="{% static 'images/favicon.png' %}" type="image/x-icon">
        <link rel="shortcut icon" href="{% static 'images/favicon.png' %}" type="image/x-icon">
        <title>Zono - Premium Admin Template</title>
        <!-- Google font -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
        <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@200;300;400;600;700;800;900&amp;display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i,900&amp;display=swap" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="{% static 'css/font-awesome.css' %}">
        <!-- ico-font-->
        <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/icofont.css' %}">
        <!-- Themify icon-->
        <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/themify.css' %}">
        <!-- Flag icon-->
        <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/flag-icon.css' %}">
        <!-- Feather icon-->
        <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/feather-icon.css' %}">
        <!-- Plugins css start-->
        <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/slick.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/slick-theme.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/scrollbar.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/jsgrid.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/animate.css' %}">
        <!-- Plugins css Ends-->
        <!-- Bootstrap css-->
        <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/bootstrap.css' %}">
        <!-- App css-->
        <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">
        <link id="color" rel="stylesheet" href="{% static 'css/color-1.css' %}" media="screen">
        <!-- Responsive css-->
        <link rel="stylesheet" type="text/css" href="{% static 'css/responsive.css' %}">
    </head>  
    <style>
      .jsgrid-align-center {
          position: sticky; /* 固定列 */
          right: 0; /* 固定在右侧 */
          z-index: 2; /* 确保它显示在其他列的上面 */
          background-color: #fff; /* 背景颜色，防止被覆盖 */
          box-shadow: -2px 0 5px rgba(0, 0, 0, 0.2); /* 给固定列添加阴影效果 */
          width: 100px !important;
      }
      .archived-row {
        border-bottom: 1px dashed #ccc;
      }
      /* 隐藏 jsGrid 默认的删除按钮 */
      .jsgrid-button.jsgrid-delete-button {
          display: none !important;
      }
      .jsgrid .jsgrid-insert-mode-button{
        display: none !important;
      }
      .jsgrid {
        background: transparent;  /* 设置按钮背景透明 */
        border: none;              /* 去除按钮的默认边框 */
        cursor: pointer;           /* 使按钮看起来像点击区域 */
        padding: 5px 10px;         /* 可选：添加内边距 */
      }
      
      .jsgrid:focus {
        outline: none;  /* 去除焦点框 */
      }
      /* 设置图标颜色为灰色 */
      .jsgrid .fa-eye {
        color: gray;  /* 改为灰色 */
      }
      
      .jsgrid-header-row {
        padding-right: 20px; /* 根据需要增加右边距 */
      }
      /* 弹窗样式 */
      #columnOptions {
          display: none; /* 默认隐藏 */
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          z-index: 1000;
          background: #fff;
          padding: 20px;
          box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
          border-radius: 8px;
          width: 1200px; /* 宽度 */
          max-height: 80vh;
          overflow-y: auto;
          text-align: center;
      }

      /* 分页导航按钮 */
      #tabNavigation {
          display: flex;
          justify-content: space-around;
          margin-bottom: 15px;
      }

      .tab-button {
          background-color: #f5f5f5; /* 按钮背景色 */
          border: 1px solid #ddd; /* 边框 */
          border-radius: 4px;
          padding: 10px 20px;
          cursor: pointer;
          transition: background-color 0.3s ease, color 0.3s ease;
          font-size: 14px;
      }

      .tab-button:hover {
          background-color: #e0e0e0; /* 悬停效果 */
      }

      .tab-button.active {
          background-color: #007bff; /* 激活背景色 */
          color: white; /* 激活文字颜色 */
          border-color: #007bff; /* 激活边框颜色 */
      }

      /* 分页内容样式 */
      #tabContent {
          border-top: 1px solid #ddd; /* 内容区顶部边框 */
          padding-top: 15px;
      }

      .tab {
          display: none; /* 默认隐藏 */
          padding: 10px;
          text-align: left; /* 内容左对齐 */
      }

      .tab.active {
          display: block; /* 激活状态下显示 */
      }

      /* 列表样式 */
      #columnSettingsList,
      #sortableColumnList {
          list-style-type: none; /* 移除默认列表样式 */
          margin: 0;
          padding: 0;
      }

      #columnSettingsList li,
      #sortableColumnList li {
          margin: 8px 0;
          padding: 10px;
          background: #f9f9f9; /* 列表项背景色 */
          border: 1px solid #ddd; /* 列表项边框 */
          border-radius: 4px; /* 圆角 */
          display: flex;
          align-items: center;
          cursor: pointer;
          transition: background-color 0.3s ease, box-shadow 0.3s ease;
      }

      #columnSettingsList li:hover,
      #sortableColumnList li:hover {
          background-color: #f1f1f1; /* 悬停背景色 */
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* 悬停阴影 */
      } 

      /* 滚动条样式（可选） */
      #columnOptions::-webkit-scrollbar {
          width: 8px;
      }

      #columnOptions::-webkit-scrollbar-thumb {
          background-color: #ccc;
          border-radius: 4px;
      }

      #columnOptions::-webkit-scrollbar-thumb:hover {
          background-color: #999;
      }
      /* 针对 #columnSettingsList 和 #sortableColumnList 设置三列布局 */
      #columnSettingsList,
      #sortableColumnList {
        column-count: 3; /* 设置为三列 */
        column-gap: 20px; /* 列之间的间距 */
        list-style: none; /* 去掉默认的列表样式 */
        padding: 0;
        margin: 0;
      }

      /* 列表项的样式调整 */
      #columnSettingsList li,
      #sortableColumnList li {
        break-inside: avoid; /* 防止列内的列表项拆分 */
        margin-bottom: 10px; /* 列表项之间的间距 */
      }

      /* 可选：为排序项添加鼠标手势和拖动视觉效果 */
      #sortableColumnList li {
        cursor: move; /* 鼠标拖动效果 */
        padding: 5px;
        border: 1px solid #ddd; /* 为拖动项增加边框方便视觉识别 */
        border-radius: 5px;
        background-color: #f9f9f9; /* 背景色 */
        margin-bottom: 10px; /* 列表项之间的间距 */
      }
      /* 排序项的基础样式 */
      #sortableColumnList li {
        cursor: move; /* 鼠标拖动效果 */
        padding: 5px;
        border: 1px solid #ddd; /* 为拖动项增加边框方便视觉识别 */
        border-radius: 5px;
        background-color: #f9f9f9; /* 背景色 */
        margin-bottom: 10px; /* 列表项之间的间距 */
        transition: background-color 0.3s ease; /* 添加平滑的颜色过渡效果 */
      }

      /* 拖动中的样式：背景变成深绿色 */
      #sortableColumnList li.sortable-chosen {
        background-color: #006400; /* 深绿色 */
        color: #fff; /* 字体颜色变成白色，确保对比清晰 */
      }

      /* 鼠标拖动时的样式：透明度变化 */
      #sortableColumnList li.sortable-drag {
        opacity: 0.8; /* 拖动项变得稍微透明，增加拖动感 */
      }
      #modalFooter {
        position: sticky; /* 固定在父容器底部 */
        bottom: -20px;
        left: 0;
        right: 0;
        background: #fff;
        padding: 10px;
        border-top: 1px solid #ddd; /* 添加顶部边框分隔 */
        display: flex;
        justify-content: space-between; /* 按钮两端对齐 */
        z-index: 10; /* 确保按钮位于内容上方 */
      }
      /* 设置表头列的背景色 */
      .jsgrid-header-cell:nth-child(1) {
        background-color: #E9EFEF !important;
      }

      /* 设置数据行对应列的背景色 */
      .jsgrid-cell:nth-child(1) {
        background-color: #E9EFEF !important;
      }

      /* 编辑模式下的输入框背景色（可选） */
      .jsgrid-edit-row input,
      .jsgrid-edit-row select {
        background-color: #E9EFEF !important;
      }
    </style>  
  <body> 
    <!-- Loader Section -->
<div class="loader-wrapper">
    <div class="theme-loader">
      <div class="loader-p"></div>
    </div>
  </div>
  
  <!-- Tap to Top Button -->
  <div class="tap-top">
    <i data-feather="chevrons-up"></i>
  </div>
  
  <!-- Page Wrapper -->
  <div class="page-wrapper compact-wrapper" id="pageWrapper">
    <!-- Header -->
    {% include 'header.html' %}
  
    <!-- Page Body Wrapper -->
    <div class="page-body-wrapper">
      <!-- Sidebar -->
      {% include 'sidenav.html' %}
  
      <!-- Main Content -->
      <div class="page-body">
        <div class="container-fluid">
          <!-- Page Title -->
          <div class="page-title">
            <div class="row">
             <!-- <div class="col-xl-4 col-sm-7 box-col-3">
                <h3>JS Grid Tables</h3>
              </div>
              -->
            </div>
          </div>
  
          <!-- Container Section -->
           
          <div class="container-fluid">
            <div class="row">
              <div class="col-sm-12">
                <div class="card">
                  <div class="card-header pb-0">
                    <h4 class="mb-3">Basic Scenario</h4>
                    <span>Grid with filtering, editing, inserting, deleting, sorting, and paging. Data provided by controller.</span>
                  </div>
                  <div class="column-control" style="position: absolute; right: 20px; top: 40px; ;">
                    <button id="columnSettings" class="btn btn-primary">
                        <i class="fa fa-cog"></i> Manage Columns
                    </button>
                </div>                
                  <div class="card-body">
                    <div class="basic_table" id="basicScenario"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="columnOptions" class="modal">
      <h4>Manage Columns</h4>
      
      <!-- 分页导航 -->
      <div id="tabNavigation">
        <button class="tab-button active" data-tab="visibility">Column Visibility</button>
        <button class="tab-button" data-tab="sorting">Column Sorting</button>
      </div>
    
      <!-- 分页内容 -->
      <div id="tabContent">
        <!-- 显示/隐藏列功能 -->
        <div id="visibility" class="tab active">
          <ul id="columnSettingsList">
            <li><label><input type="checkbox" class="column-toggle" data-column="Label" checked> Status</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Address" checked> Address</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="City" checked> City</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Zip" checked> Zip</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Auction Authority" checked> Auction Authority</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="State" checked> State</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Amount In Sale" checked> Amount In Sale</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Deposit Deadline" checked> Deposit Deadline</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Auction Start" checked> Auction Start</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Auction End" checked> Auction End</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="My Bid" checked> My Bid</label></li>
            
            <!-- 新字段 -->
            <li><label><input type="checkbox" class="column-toggle" data-column="Batch Number" checked> Batch Number</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Sort No" checked> Sort No</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Bankruptcy Flag" checked> Bankruptcy Flag</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Parcel Number" checked> Parcel Number</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Property Class" checked> Property Class</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Tax Overdue" checked> Tax Overdue</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Accessed Land Value" checked> Accessed Land Value</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Accessed Improvement Value" checked> Accessed Improvement Value</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Total Assessed Value" checked> Total Assessed Value</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Tax Amount Annual" checked> Tax Amount Annual</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Zillow Link" checked> Zillow Link</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Redfin Link" checked> Redfin Link</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Market Land Value" checked> Market Land Value</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Market Improvement Value" checked> Market Improvement Value</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Total Market Value" checked> Total Market Value</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Year Built" checked> Year Built</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Lot Size (sqft)" checked> Lot Size (sqft)</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Lot Size (acres)" checked> Lot Size (acres)</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Building Size (sqft)" checked> Building Size (sqft)</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Bedroom Number" checked> Bedroom Number</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Bathroom Number" checked> Bathroom Number</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Nearby Schools" checked> Nearby Schools</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Walk Score" checked> Walk Score</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Transit Score" checked> Transit Score</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Bike Score" checked> Bike Score</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Environmental Hazard Status" checked> Environmental Hazard Status</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Flood Status" checked> Flood Status</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Flood Risk" checked> Flood Risk</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Latest Sale Date" checked> Latest Sale Date</label></li>
            <li><label><input type="checkbox" class="column-toggle" data-column="Latest Sale Price" checked> Latest Sale Price</label></li>
          </ul>
        </div>
    
        <!-- 列排序功能 -->
        <div id="sorting" class="tab">
          <ul id="sortableColumnList">
            <li class="sortable-item" data-column="Label">Status</li>
            <li class="sortable-item" data-column="Address">Address</li>
            <li class="sortable-item" data-column="City">City</li>
            <li class="sortable-item" data-column="Zip">Zip</li>
            <li class="sortable-item" data-column="Auction Authority">Auction Authority</li>
            <li class="sortable-item" data-column="State">State</li>
            <li class="sortable-item" data-column="Amount In Sale">Amount In Sale</li>
            <li class="sortable-item" data-column="Deposit Deadline">Deposit Deadline</li>
            <li class="sortable-item" data-column="Auction Start">Auction Start</li>
            <li class="sortable-item" data-column="Auction End">Auction End</li>
            <li class="sortable-item" data-column="My Bid">My Bid</li>
            
            <li class="sortable-item" data-column="Batch Number">Batch Number</li>
            <li class="sortable-item" data-column="Sort No">Sort No</li>
            <li class="sortable-item" data-column="Bankruptcy Flag">Bankruptcy Flag</li>
            <li class="sortable-item" data-column="Parcel Number">Parcel Number</li>
            <li class="sortable-item" data-column="Property Class">Property Class</li>
            <li class="sortable-item" data-column="Tax Overdue">Tax Overdue</li>
            <li class="sortable-item" data-column="Accessed Land Value">Accessed Land Value</li>
            <li class="sortable-item" data-column="Accessed Improvement Value">Accessed Improvement Value</li>
            <li class="sortable-item" data-column="Total Assessed Value">Total Assessed Value</li>
            <li class="sortable-item" data-column="Tax Amount Annual">Tax Amount Annual</li>
            <li class="sortable-item" data-column="Zillow Link">Zillow Link</li>
            <li class="sortable-item" data-column="Redfin Link">Redfin Link</li>
            <li class="sortable-item" data-column="Market Land Value">Market Land Value</li>
            <li class="sortable-item" data-column="Market Improvement Value">Market Improvement Value</li>
            <li class="sortable-item" data-column="Total Market Value">Total Market Value</li>
            <li class="sortable-item" data-column="Year Built">Year Built</li>
            <li class="sortable-item" data-column="Lot Size (sqft)">Lot Size (sqft)</li>
            <li class="sortable-item" data-column="Lot Size (acres)">Lot Size (acres)</li>
            <li class="sortable-item" data-column="Building Size (sqft)">Building Size (sqft)</li>
            <li class="sortable-item" data-column="Bedroom Number">Bedroom Number</li>
            <li class="sortable-item" data-column="Bathroom Number">Bathroom Number</li>
            <li class="sortable-item" data-column="Nearby Schools">Nearby Schools</li>
            <li class="sortable-item" data-column="Walk Score">Walk Score</li>
            <li class="sortable-item" data-column="Transit Score">Transit Score</li>
            <li class="sortable-item" data-column="Bike Score">Bike Score</li>
            <li class="sortable-item" data-column="Environmental Hazard Status">Environmental Hazard Status</li>
            <li class="sortable-item" data-column="Flood Status">Flood Status</li>
            <li class="sortable-item" data-column="Flood Risk">Flood Risk</li>
            <li class="sortable-item" data-column="Latest Sale Date">Latest Sale Date</li>
            <li class="sortable-item" data-column="Latest Sale Price">Latest Sale Price</li>
          </ul>
        </div>
      </div>
      <!-- 按钮区域 -->
      <div id="modalFooter">
        <button id="saveColumnSettings" class="btn btn-success">Save</button>
        <button id="closeColumnSettings" class="btn btn-secondary">Cancel</button>
      </div>
    </div>
    
    <!-- Footer -->
    
      {% include 'footer-light.html' %}
    
    </div>
   
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const grid = $("#basicScenario").data("JSGrid");
    
        // 点击配置列按钮，显示弹窗
        document.getElementById("columnSettings").addEventListener("click", function () {
          const modal = document.getElementById("columnOptions");
          modal.style.display = "block"; // 显示弹窗
        });
    
        // 点击取消按钮，隐藏弹窗
        document.getElementById("closeColumnSettings").addEventListener("click", function () {
          const modal = document.getElementById("columnOptions");
          modal.style.display = "none"; // 隐藏弹窗
        });
    
        // 点击空白处关闭弹窗
        document.addEventListener("click", function (event) {
          const modal = document.getElementById("columnOptions");
          if (modal && modal.style.display === "block" && !modal.contains(event.target) && !event.target.closest("#columnSettings")) {
            modal.style.display = "none"; // 关闭模态框
          }
        });
    
        // 防止模态框内部点击触发关闭
        const modalContent = document.getElementById("columnOptions");
        if (modalContent) {
          modalContent.addEventListener("click", function (event) {
            event.stopPropagation(); // 阻止事件冒泡
          });
        }
    
        // 实时更新列的显示/隐藏状态
        document.querySelectorAll(".column-toggle").forEach(function (checkbox) {
          checkbox.addEventListener("change", function () {
            const columnName = this.dataset.column;
            const isVisible = this.checked;
    
            // 实时更新表格中的列显示/隐藏状态
            const fieldIndex = grid.fields.findIndex((field) => field.name === columnName);
            if (fieldIndex >= 0) {
              grid.fields[fieldIndex].visible = isVisible;
              $("#basicScenario").jsGrid("option", "fields", grid.fields);
              $("#basicScenario").jsGrid("refresh");
            }
          });
        });
    
        // 点击保存按钮，保存设置到 localStorage
        document.getElementById("saveColumnSettings").addEventListener("click", function () {
          const columnSettings = {};
    
          // 获取当前的列显示状态
          document.querySelectorAll(".column-toggle").forEach(function (checkbox) {
            const columnName = checkbox.dataset.column;
            const isVisible = checkbox.checked;
    
            // 保存列的显示状态
            columnSettings[columnName] = isVisible;
          });
    
          // 保存到 localStorage
          localStorage.setItem("columnSettings", JSON.stringify(columnSettings));
    
          // 提示保存成功
          // alert("Settings saved successfully!");
    
          // 隐藏弹窗
          const modal = document.getElementById("columnOptions");
          modal.style.display = "none";
        });
    
        // 页面加载时，恢复列设置
        window.addEventListener("load", function () {
          const savedSettings = localStorage.getItem("columnSettings");
    
          if (savedSettings) {
            const columnSettings = JSON.parse(savedSettings);
    
            // 恢复复选框和表格列的显示状态
            document.querySelectorAll(".column-toggle").forEach(function (checkbox) {
              const columnName = checkbox.dataset.column;
              const isVisible = columnSettings[columnName];
    
              checkbox.checked = isVisible; // 根据保存的设置更新复选框状态
    
              // 恢复表格列的显示/隐藏状态
              const fieldIndex = grid.fields.findIndex((field) => field.name === columnName);
              if (fieldIndex >= 0) {
                grid.fields[fieldIndex].visible = isVisible;
              }
            });
    
            // 更新表格字段并刷新
            $("#basicScenario").jsGrid("option", "fields", grid.fields);
            $("#basicScenario").jsGrid("refresh");
          }
        });
      });
    </script>
    
    
    <!--拖动排序功能-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        let tempSortedColumns = []; // 临时存储拖动后的列顺序
      
        // 初始化拖动排序功能（使用SortableJS库）
        const sortable = new Sortable(document.getElementById("sortableColumnList"), {
          animation: 150,
          onEnd: function () {
            updateTempColumnOrder(); // 拖动结束后更新临时列顺序
            syncSortingWithVisibility(); // 同步更新第一页的顺序
          },
        });
        
        // 同步第一页的顺序与第二页的排序
        function syncSortingWithVisibility() {
          const columnSettingsList = document.getElementById("columnSettingsList");
          const visibilityItems = Array.from(columnSettingsList.querySelectorAll("li"));
        
          tempSortedColumns.forEach((column) => {
            const matchingItem = visibilityItems.find(
              (item) => item.querySelector(".column-toggle").dataset.column === column
            );
            if (matchingItem) {
              columnSettingsList.appendChild(matchingItem); // 调整顺序
            }
          });
        }
      
        // 更新临时列顺序（但不保存）
        function updateTempColumnOrder() {
          tempSortedColumns = Array.from(
            document.querySelectorAll("#sortableColumnList .sortable-item")
          ).map((item) => item.getAttribute("data-column"));
      
          // 实时更新表格列顺序（但不保存到localStorage）
          const grid = $("#basicScenario").data("JSGrid");
          const newFields = [];
      
          // 确保所有字段包括 control
          const allFields = [...grid.fields];
          tempSortedColumns.forEach((column) => {
            const field = allFields.find((f) => f.name === column);
            if (field) newFields.push(field);
          });
      
          // 保证没有遗漏 control 列
          const controlField = allFields.find((f) => f.type === "control");
          if (controlField && !newFields.includes(controlField)) {
            newFields.push(controlField); // 确保 control 列在最后
          }
      
          // 更新 jsGrid 的 fields 配置并刷新表格
          grid.fields = newFields;
          $("#basicScenario").jsGrid("option", "fields", grid.fields);
          $("#basicScenario").jsGrid("refresh");
        }
      
        // 点击保存按钮，保存显示状态和排序到 localStorage
        document.getElementById("saveColumnSettings").addEventListener("click", function () {
          const columnSettings = {};
      
          // 保存列显示状态
          document.querySelectorAll(".column-toggle").forEach(function (checkbox) {
            const columnName = checkbox.dataset.column;
            const isVisible = checkbox.checked;
            columnSettings[columnName] = isVisible;
          });
      
          // 保存排序顺序
          const sortedColumnsToSave = tempSortedColumns.length
            ? tempSortedColumns // 如果有拖动排序，保存临时排序
            : Array.from(document.querySelectorAll("#sortableColumnList .sortable-item")).map((item) =>
                item.getAttribute("data-column")
              );
      
          // 保存到 localStorage
          localStorage.setItem("columnSettings", JSON.stringify(columnSettings));
          localStorage.setItem("sortedColumns", JSON.stringify(sortedColumnsToSave));
      
          // 提示保存成功
          // alert("Settings saved successfully!");
      
          // 隐藏弹窗
          document.getElementById("columnOptions").style.display = "none";
        });
      
        // 页面加载时，恢复列设置和排序
        const savedSettings = localStorage.getItem("columnSettings");
        const savedSorting = localStorage.getItem("sortedColumns");
      
        if (savedSettings && savedSorting) {
          const columnSettings = JSON.parse(savedSettings);
          const sortedColumns = JSON.parse(savedSorting);
          const grid = $("#basicScenario").data("JSGrid");
      
          // 恢复列显示状态
          document.querySelectorAll(".column-toggle").forEach(function (checkbox) {
            const columnName = checkbox.dataset.column;
            const isVisible = columnSettings[columnName];
            checkbox.checked = isVisible;
      
            // 隐藏/显示对应列
            const sortingItem = document.querySelector(
              `#sortableColumnList [data-column="${columnName}"]`
            );
            if (sortingItem) {
              sortingItem.style.display = isVisible ? "block" : "none";
            }
          });
      
          // 恢复排序
          const newFields = [];
          sortedColumns.forEach((column) => {
            const sortingItem = document.querySelector(
              `#sortableColumnList [data-column="${column}"]`
            );
            if (sortingItem) {
              document.getElementById("sortableColumnList").appendChild(sortingItem); // 调整顺序
            }
      
            const visibilityItem = document
              .querySelector(
                `#columnSettingsList .column-toggle[data-column="${column}"]`
              )
              .closest("li");
            if (visibilityItem) {
              document.getElementById("columnSettingsList").appendChild(visibilityItem); // 调整顺序
            }
      
            // 更新 jsGrid 的 fields 配置
            const field = grid.fields.find((f) => f.name === column);
            if (field) newFields.push(field);
          });
      
          // 确保 control 列存在
          const controlField = grid.fields.find((f) => f.type === "control");
          if (controlField && !newFields.includes(controlField)) {
            newFields.push(controlField); // 确保 control 列在最后
          }
      
          grid.fields = newFields;
          $("#basicScenario").jsGrid("option", "fields", grid.fields);
          $("#basicScenario").jsGrid("refresh");
        }
      
        // 点击Tab切换
        document.querySelectorAll(".tab-button").forEach((button) => {
          button.addEventListener("click", function () {
            document.querySelectorAll(".tab-button").forEach((btn) =>
              btn.classList.remove("active")
            );
            this.classList.add("active");
      
            const tabName = this.dataset.tab;
            document.querySelectorAll(".tab").forEach((tab) => (tab.style.display = "none"));
            document.getElementById(tabName).style.display = "block";
          });
        });
      
        // 同步隐藏列与排序列表
        document.querySelectorAll(".column-toggle").forEach(function (checkbox) {
          checkbox.addEventListener("change", function () {
            const columnName = this.dataset.column;
            const isVisible = this.checked;
      
            // 同步隐藏/显示
            const sortingItem = document.querySelector(
              `#sortableColumnList [data-column="${columnName}"]`
            );
            if (sortingItem) {
              sortingItem.style.display = isVisible ? "block" : "none";
            }
          });
        });
      });
    </script>
    <!--渲染表格-->
    <script>
      window.addEventListener('resize', () => {
        const grid = $('#grid').data('JSGrid');
        if (grid) {
          grid.refresh(); // 重新渲染表格
        }
      });   
    </script> 
    <!-- latest jquery-->
    <script src="{% static 'js/jquery.min.js' %}"></script>
    <!-- Bootstrap js-->
    <script src="{% static 'js/bootstrap/bootstrap.bundle.min.js' %}"></script>
    <!-- feather icon js-->
    <script src="{% static 'js/icons/feather-icon/feather.min.js' %}"></script>
    <script src="{% static 'js/icons/feather-icon/feather-icon.js' %}"></script>
    <!-- scrollbar js-->
    <script src="{% static 'js/scrollbar/simplebar.js' %}"></script>
    <script src="{% static 'js/scrollbar/custom.js' %}"></script>
    <!-- Sidebar jquery-->
    <script src="{% static 'js/config.js' %}"></script>
    <!-- Plugins JS start-->
    <script src="{% static 'js/sidebar-menu.js' %}"></script>
    <script src="{% static 'js/sidebar-pin.js' %}"></script>
    <script src="{% static 'js/slick/slick.min.js' %}"></script>
    <script src="{% static 'js/slick/slick.js' %}"></script>
    <script src="{% static 'js/header-slick.js' %}"></script>
    <script src="{% static 'js/jsgrid/jsgrid.min.js' %}"></script>
    <script src="{% static 'js/jsgrid/griddata.js' %}"></script>
    <script src="{% static 'js/jsgrid/jsgrid.js' %}"></script>
    <!-- Plugins JS Ends-->
    <!-- Theme js-->
    <script src="{% static 'js/script.js' %}"></script>
    <script src="{% static 'js/theme-customizer/customizer.js' %}"></script>
    <!-- Plugin used-->
  </body>
</html>