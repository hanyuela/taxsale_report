<!DOCTYPE html>
<html lang="en">
<head>
  {% load static %}
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Payment Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Zono admin is super flexible, powerful, clean &amp; modern responsive bootstrap 5 admin template with unlimited possibilities.">
  <meta name="keywords" content="admin template, Zono admin template, dashboard template, flat admin template, responsive admin template, web app">
  <meta name="author" content="pixelstrap">
  <link rel="icon" href="{% static 'images/favicon.png' %}" type="image/x-icon">
  <link rel="shortcut icon" href="{% static 'images/favicon.png' %}" type="image/x-icon">
  <title>Zono - Premium Admin Template</title>
  <!-- Google font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
  <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@200;300;400;600;700;800;900&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i,900&amp;display=swap" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="{% static 'css/font-awesome.css' %}">
  <!-- ico-font-->
  <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/icofont.css' %}">
  <!-- Themify icon-->
  <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/themify.css' %}">
  <!-- Flag icon-->
  <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/flag-icon.css' %}">
  <!-- Feather icon-->
  <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/feather-icon.css' %}">
  <!-- Plugins css start-->
  <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/slick.css' %}">
  <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/slick-theme.css' %}">
  <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/scrollbar.css' %}">
  <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/jsgrid.css' %}">
  <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/animate.css' %}">
  <!-- Plugins css Ends-->
  <!-- Bootstrap css-->
  <link rel="stylesheet" type="text/css" href="{% static 'css/vendors/bootstrap.css' %}">
  <!-- App css-->
  <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">
  <link id="color" rel="stylesheet" href="{% static 'css/color-1.css' %}" media="screen">
  <!-- Responsive css-->
  <link rel="stylesheet" type="text/css" href="{% static 'css/responsive.css' %}">  
</head>
<style>
  /* 外部容器样式，统一设置最大宽度和居中显示 */
    .profile-container {
      max-width: 600px; /* 设置最大宽度 */
      margin: 0 auto; /* 居中显示 */
      padding: 17px; /* 左右内边距 */
      box-sizing: border-box; /* 包括内边距在内的宽度计算 */
    }

    /* 统一输入框样式 */
    .profile-container .form-control {
      width: 100%; /* 输入框宽度100%，但受容器限制 */
      padding: 10px 12px; /* 输入框内边距 */
      box-sizing: border-box; /* 保证宽度包含内边距 */
    }

    /* 统一标签样式 */
    .profile-container .form-label {
      display: block; /* 标签单独一行显示 */
      margin-bottom: 8px; /* 标签与输入框的间距 */
      color: #333; /* 标签字体颜色 */
      font-weight: bold; /* 标签字体加粗 */
    }

    /* 按钮样式 */
    .profile-container .btn {
      margin-top: 5px; /* 按钮与输入框的间距 */
      padding: 10px;
      width: 100%;
    }
    /* 设置外部容器整体样式 */
    .card {
      padding: 20px; /* 添加内边距 */
      max-width: 800px; /* 设置最大宽度，确保不会过于宽 */
      margin: 0 auto; /* 居中显示 */
      box-sizing: border-box; /* 包括内边距在内计算宽度 */
    }

    /* 输入框和复选框的通用样式 */
    .card .form-control,
    .card input[type="radio"],
    .card input[type="checkbox"] {
      margin-left: 10px; /* 增加左边距 */
      margin-bottom: 20px;
    }

    /* 标签与输入框对齐 */
    .card label {
      margin-left: 10px; /* 标签左边距 */
      font-weight: bold; /* 标签加粗 */
      color: #333; /* 标签字体颜色 */
    }

    /* 调整单选框和复选框 */
    .card input[type="radio"],
    .card input[type="checkbox"] {
      margin-right: 5px; /* 控件与标签之间的间距 */
    }

    /* 提交按钮样式 */
    .card-footer .btn {
      margin-top: 10px;
      padding: 10px 20px;
    }
    .apply-btn {
      display: block;
      margin-left: auto;
      margin-right: 0;
    }
    .radio-option {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px; /* 增加每个选项的间距 */
    }
    
    .radio-option label {
      flex: 1; /* 标签占据左侧空间 */
    }
    
    .radio-option input[type="radio"] {
      margin: 0;
      vertical-align: middle; /* 确保按钮垂直居中 */
    }
    p {
      font-size: 14px;
      letter-spacing: 0.7px;
      margin-left: 10px;
      line-height: 1.7;
    }
  </style>
<body>

<!-- loader starts-->
<div class="loader-wrapper">
  <div class="theme-loader">    
    <div class="loader-p"></div>
  </div>
</div>
<!-- loader ends-->
<!-- tap on top starts-->
<div class="tap-top"><i data-feather="chevrons-up"></i></div>
<!-- tap on tap ends-->
<!-- page-wrapper Start-->
<div class="page-wrapper compact-wrapper" id="pageWrapper">
  <!-- Page Header Start-->
  {% include 'header.html' %}
  <!-- Page Header Ends                              -->
  <!-- Page Body Start-->
  <div class="page-body-wrapper">
    <!-- Page Sidebar Start-->
    {% include 'sidenav.html' %}
    <!-- Page Sidebar Ends-->
    <div class="page-body">
      <div class="container-fluid">
        <div class="page-title">
          <div class="row">
            <div class="col-xl-3 col-sm-5 box-col-4">                 
            </div>
          </div>
        </div>
      </div>
      <!-- Container-fluid starts-->
      <div class="container">
        <div class="row">

          <div class="col-md-6">
            <div class="card">
              <div class="card-body">
                <!-- Remaining Balance -->
                <div class="form-group">
                  <label for="remaining_balance">Remaining Balance</label>
                  <input class="form-control" id="remaining_balance" type="text" value="$99" disabled>
                </div>
          
                <!-- 分隔线 -->
                <hr class="my-4">
          
                <!-- Step 1: Payment Method Selection -->
                <div id="payment-method-section">
                  <div class="form-group">
                    <label for="amount">Add Funds</label>
                    <input class="form-control" id="amount" type="number" placeholder="Enter amount">
                  </div>
          
                  <!-- Select Payment Method -->
                  <div class="form-group">
                    <label>Select Payment Method</label>
                    {% if payment_methods.exists %}
                      {% for method in payment_methods %}
                        <div class="radio-option">
                          <label>
                            {{ method.get_method_display }}
                            <br>
                            <small class="text-muted">
                              Stripe ID: {{ method.stripe_payment_method_id|default:"N/A" }}<br>
                              Created at: {{ method.created_at|date:"Y-m-d H:i:s" }}
                            </small>
                          </label>
                          <input type="radio" name="payment_method" value="{{ method.method }}">
                        </div>
                      {% endfor %}
                    {% else %}
                      <p class="text-muted">No payment methods available. Please add one.</p>
                    {% endif %}
                  </div>
          
                  <!-- Add Payment Method -->
                  <div class="form-group mt-4">
                    <label>Add Payment Method</label>
                    <div class="radio-option">
                      <p>Debit or Credit Card</p>
                      <input type="radio" name="payment_method" value="credit_card">
                    </div>
                    <div class="radio-option">
                      <p>PayPal</p>
                      <input type="radio" name="payment_method" value="paypal">
                    </div>
                    <div class="radio-option">
                      <p>Wire Transfer</p>
                      <input type="radio" name="payment_method" value="add_wire_transfer">
                    </div>
                  </div>
          
                  <!-- Next 按钮 -->
                  <div class="text-end mt-4">
                    <button id="apply-btn" class="btn btn-primary">Next</button>
                  </div>
                </div>
          
                <!-- Form for Step 2 and Step 3 -->
                <form id="payment-form" method="POST">
                  {% csrf_token %}
          
                  <!-- Step 2: Add Payment Method -->
                  <!-- 第二部分：添加支付方式 -->
                  <div id="add-payment-form" style="display: none;">
                    <h4>Debit or Credit Card</h4>
                    <div class="form-group">
                      <label for="card_name">Name on Card</label>
                      <input class="form-control" id="card_name" type="text" placeholder="Enter cardholder name">
                    </div>
                    <div class="form-group">
                      <label for="card_number">Card Number</label>
                      <input class="form-control" id="card_number" type="text" placeholder="Enter card number">
                    </div>
                    <div class="form-row">
                      <div class="form-group col-md-6">
                        <label for="expiry_date">MM/YY</label>
                        <input class="form-control" id="expiry_date" type="text" placeholder="MM/YY">
                      </div>
                      <div class="form-group col-md-6">
                        <label for="cvv">CVV</label>
                        <input class="form-control" id="cvv" type="text" placeholder="CVV">
                      </div>
                    </div>
                    <div class="text-end mt-4">
                      <button id="save-payment-method-btn" class="btn btn-success">Save</button>
                    </div>
                  </div>
          
                    <!-- Add Billing Address -->
                    <h5 class="mt-4">Billing Address</h5>
                    <div>
                      <!-- Saved Billing Address -->
                      <div class="radio-option">
                        <input type="radio" id="saved_billing_1" name="billing_address" value="saved_address_1">
                        <label for="saved_billing_1">
                          <strong>Hanyue Wang</strong><br>
                          1515 Colby Ave Apt 104, Los Angeles, CA, US, 90025
                        </label>
                      </div>
          
                      <!-- Add New Billing Address -->
                      <div class="mt-3">
                        <a href="#" id="add-billing-address-link" class="text-primary">Add billing address</a>
                      </div>
                    </div>
                  </div>
          
                  <!-- Step 3: Add Billing Address -->
                  <div id="new-billing-address-form" style="display: none;">
                    <h5>Add Billing Address</h5>
                    <div class="form-group">
                      <label for="country_region">Country or Region</label>
                      <input class="form-control" id="country_region" type="text" value="United States" readonly>
                    </div>
                    <div class="form-group">
                      <label for="full_name">Full Name</label>
                      <input class="form-control" id="full_name" type="text" placeholder="Full name">
                    </div>
                    <div class="form-group">
                      <label for="business_name">Business Name (if applicable)</label>
                      <input class="form-control" id="business_name" type="text" placeholder="Business name">
                    </div>
                    <div class="form-group">
                      <label for="address">Address</label>
                      <input class="form-control" id="address" type="text" placeholder="Address">
                    </div>
                    <div class="form-group">
                      <label for="address_line_2">Address Line 2 (optional)</label>
                      <input class="form-control" id="address_line_2" type="text" placeholder="Address line 2 (optional)">
                    </div>
                    <div class="form-row">
                      <div class="form-group col-md-6">
                        <label for="city">City</label>
                        <input class="form-control" id="city" type="text" placeholder="City">
                      </div>
                      <div class="form-group col-md-3">
                        <label for="state">State</label>
                        <input class="form-control" id="state" type="text" placeholder="State">
                      </div>
                      <div class="form-group col-md-3">
                        <label for="zip_code">ZIP Code</label>
                        <input class="form-control" id="zip_code" type="text" placeholder="ZIP code">
                      </div>
                    </div>
                    <div class="text-end mt-4">
                      <button id="save-billing-address-btn" class="btn btn-success">Save</button>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
          
          

      
          <!-- 右侧内容 -->
          <div class="col-md-6">
            <div class="card">
              <div class="card-body">
                <div class="form-group">
                  <label>Subscription Information</label>
                  <p>Current Subscription</p>
                  <p>Member Since: 11/22/2024</p>
                  <p>Payment Interval: Monthly / Yearly</p>
                  <p>Next Payment On: 12/21/2024</p>
                  <p>Next Payment Amount: $5.00</p>
                </div>
                <div class="form-group">
                  <button class="btn btn-primary" style="margin-top: 15px; margin-bottom: 15px; margin-left: 10px;">
                    Cancel Next Subscription
                  </button>
                </div>                
                <div class="form-group mt-4"> <!-- 增加了 margin-top -->
                  <label for="coupon">Use Coupon</label>
                  <div style="display: flex; align-items: center;">
                    <input class="form-control" id="coupon" type="text" placeholder="Enter coupon code" style="flex: 1; margin-right: 10px; height: 38px;">
                    <button id="apply-btn" class="btn btn-primary" style="height: 38px; margin-bottom: 20px;">Apply</button>
                  </div>
                </div>                              
              </div>  
            </div>
          </div>
        </div>
      </div>
      
      <!-- Container-fluid Ends-->
    </div>
    <!-- footer start-->
    {% include 'footer-light.html' %}
  </div>
</div>
  
</body>
</html>
<!-- latest jquery-->
<script src="{% static 'js/jquery.min.js' %}"></script>
<!-- Bootstrap js-->
<script src="{% static 'js/bootstrap/bootstrap.bundle.min.js' %}"></script>
<!-- feather icon js-->
<script src="{% static 'js/icons/feather-icon/feather.min.js' %}"></script>
<script src="{% static 'js/icons/feather-icon/feather-icon.js' %}"></script>
<!-- scrollbar js-->
<script src="{% static 'js/scrollbar/simplebar.js' %}"></script>
<script src="{% static 'js/scrollbar/custom.js' %}"></script>
<!-- Sidebar jquery-->
<script src="{% static 'js/config.js' %}"></script>
<!-- Plugins JS start-->
<script src="{% static 'js/sidebar-menu.js' %}"></script>
<script src="{% static 'js/sidebar-pin.js' %}"></script>
<script src="{% static 'js/slick/slick.min.js' %}"></script>
<script src="{% static 'js/slick/slick.js' %}"></script>
<script src="{% static 'js/header-slick.js' %}"></script>
<script src="{% static 'js/jsgrid/jsgrid.min.js' %}"></script>
<script src="{% static 'js/jsgrid/griddata.js' %}"></script>
<script src="{% static 'js/jsgrid/jsgrid.js' %}"></script>
<!-- Plugins JS Ends-->
<!-- Theme js-->
<script src="{% static 'js/script.js' %}"></script>
<script src="{% static 'js/theme-customizer/customizer.js' %}"></script>
<!-- Plugin used-->

<script>
  $(document).ready(function () {
    // 点击 "Next" 按钮切换到第二部分
    $('#apply-btn').click(function () {
      const paymentOptions = Array.from(document.getElementsByName('payment_method'));
      let selectedOption = null;
  
      // 获取选中的支付方式
      for (let i = 0; i < paymentOptions.length; i++) {
        if (paymentOptions[i].checked) {
          selectedOption = paymentOptions[i].value;
          break;
        }
      }
  
      // 判断是否选择了支付方式
      if (selectedOption) {
        if (selectedOption === 'credit_card' || selectedOption === 'paypal' || selectedOption === 'add_wire_transfer') {
          // 如果选择新增支付方式，显示支付方式表单
          $('#payment-method-section').hide();
          $('#add-payment-form').show();
        } else {
          // 已保存的支付方式（可以添加直接处理逻辑）
          alert('Proceeding with the selected saved payment method: ' + selectedOption);
        }
      } else {
        alert('Please select a payment method.');
      }
    });
  
    // 保存支付方式（第二步）
    $('#save-payment-method-btn').click(function (e) {
      e.preventDefault();
  
      // 获取表单数据
      const cardName = $('#card_name').val();
      const cardNumber = $('#card_number').val();
      const expiryDate = $('#expiry_date').val();
      const cvv = $('#cvv').val();
  
      // 校验数据
      if (!cardName || !cardNumber || !expiryDate || !cvv) {
        alert('Please fill all the card details!');
        return;
      }
  
      // 发送 AJAX 请求到后端保存支付方式
      $.ajax({
        url: '/save-payment-method/', // 后端 API 路径
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({
          card_name: cardName,
          card_number: cardNumber,
          expiry_date: expiryDate,
          cvv: cvv,
          csrfmiddlewaretoken: $('input[name="csrfmiddlewaretoken"]').val(),
        }),
        success: function (response) {
          if (response.success) {
            alert('Payment method saved successfully!');
            // 隐藏支付方式表单，显示账单地址表单
            $('#add-payment-form').hide();
            $('#new-billing-address-form').show();
          } else {
            alert('Error saving payment method: ' + response.message);
          }
        },
        error: function (xhr, status, error) {
          alert('Error processing request: ' + error);
        },
      });
    });
  
    // 保存账单地址（第三步）
    $('#save-billing-address-btn').click(function (e) {
      e.preventDefault();
  
      // 获取账单地址数据
      const countryRegion = $('#country_region').val();
      const fullName = $('#full_name').val();
      const businessName = $('#business_name').val();
      const address = $('#address').val();
      const addressLine2 = $('#address_line_2').val();
      const city = $('#city').val();
      const state = $('#state').val();
      const zipCode = $('#zip_code').val();
  
      // 校验数据
      if (!fullName || !address || !city || !state || !zipCode) {
        alert('Please fill all required address details!');
        return;
      }
  
      // 发送 AJAX 请求到后端保存账单地址
      $.ajax({
        url: '/save-billing-address/', // 后端 API 路径
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({
          country_region: countryRegion,
          full_name: fullName,
          business_name: businessName,
          address: address,
          address_line_2: addressLine2,
          city: city,
          state: state,
          zip_code: zipCode,
          csrfmiddlewaretoken: $('input[name="csrfmiddlewaretoken"]').val(),
        }),
        success: function (response) {
          if (response.success) {
            alert('Billing address saved successfully!');
          } else {
            alert('Error saving billing address: ' + response.message);
          }
        },
        error: function (xhr, status, error) {
          alert('Error processing request: ' + error);
        },
      });
    });
  
    // 显示/隐藏账单地址表单
    $('#add-billing-address-link').click(function (e) {
      e.preventDefault();
      $('#new-billing-address-form').toggle();
    });
  });
  
  
</script>

